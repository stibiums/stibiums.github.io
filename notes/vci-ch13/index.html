<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> VCI - 13: 着色 (Shading) | STIBIUMS_WEB </title> <meta name="author" content="stibiums liu"> <meta name="description" content="A simple, whitespace theme for academics. Based on [*folio](https://github.com/bogoli/-folio) design. "> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" href="/assets/css/scholar-icons.css?62b2ac103a88034e6882a5be5f3e2772"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="/assets/img/touxiang.jpg?68b4199d95528c9129ff55a104244865"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://stibiums.github.io/notes/vci-ch13/"> <script src="/assets/js/theme.js?a81d82887dd692e91686b43de4542f18"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>
    initTheme();
  </script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> STIBIUMS_WEB </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item "> <a class="nav-link" href="/blog/">blog </a> </li> <li class="nav-item active"> <a class="nav-link" href="/notes/">notes <span class="sr-only">(current)</span> </a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">projects </a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv </a> </li> <li class="nav-item"> <button id="search-toggle" title="Search" onclick="openSearchModal()"> <span class="nav-link">ctrl k <i class="ti ti-search"></i></span> </button> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">VCI - 13: 着色 (Shading)</h1> <p class="post-meta"> Created on October 30, 2025 </p> <p class="post-tags"> <i class="fa-solid fa-calendar fa-sm"></i> 2025   ·   <i class="fa-solid fa-hashtag fa-sm"></i> notes   <i class="fa-solid fa-hashtag fa-sm"></i> VCI   <i class="fa-solid fa-hashtag fa-sm"></i> graphics   <i class="fa-solid fa-hashtag fa-sm"></i> shading   <i class="fa-solid fa-hashtag fa-sm"></i> illumination   <i class="fa-solid fa-hashtag fa-sm"></i> visibility   <i class="fa-solid fa-hashtag fa-sm"></i> shadows   ·   <i class="fa-solid fa-tag fa-sm"></i> VCI </p> </header> <article class="post-content"> <div id="markdown-content"> <blockquote> <p><strong>课程</strong>: 北京大学视觉计算 (Visual Computing) 2025秋季 <strong>章节</strong>: 第13章 着色 <strong>内容</strong>: 光源、反射模型、照明方程、着色算法、可见性、阴影、非照相写实渲染</p> </blockquote> <h2 id="目录">目录</h2> <ol> <li><a href="#1-%E7%9D%80%E8%89%B2%E6%A6%82%E8%BF%B0">着色概述</a></li> <li><a href="#2-%E5%85%89%E6%BA%90">光源</a></li> <li><a href="#3-%E5%8F%8D%E5%B0%84%E4%B8%8E%E7%85%A7%E6%98%8E%E6%A8%A1%E5%9E%8B">反射与照明模型</a></li> <li><a href="#4-%E7%9D%80%E8%89%B2%E7%AE%97%E6%B3%95">着色算法</a></li> <li><a href="#5-%E5%8F%AF%E8%A7%81%E6%80%A7%E9%97%AE%E9%A2%98">可见性问题</a></li> <li><a href="#6-%E9%98%B4%E5%BD%B1">阴影</a></li> <li><a href="#7-%E9%9D%9E%E7%85%A7%E7%9B%B8%E5%86%99%E5%AE%9E%E6%B8%B2%E6%9F%93">非照相写实渲染</a></li> </ol> <hr> <h2 id="1-着色概述">1. 着色概述</h2> <h3 id="11-什么是着色">1.1 什么是着色</h3> <p><strong>着色</strong> (Shading) 是对几何体进行着色，使其看起来像具有特定材质性质并在光照下反应的物体。</p> <h3 id="12-着色的三个关键要素">1.2 着色的三个关键要素</h3> <ol> <li> <strong>光传输 (Light Transport)</strong> — 光线如何从光源传播到表面</li> <li> <strong>反射率 (Reflectance)</strong> — 材料表面如何反射光</li> <li> <strong>感知 (Perception)</strong> — 人眼如何感知最终的图像</li> </ol> <h3 id="13-光栅化vs光线追踪">1.3 光栅化vs光线追踪</h3> <table> <thead> <tr> <th>特性</th> <th>光栅化 (Rasterization)</th> <th>光线追踪 (Ray Tracing)</th> </tr> </thead> <tbody> <tr> <td><strong>类比</strong></td> <td>绘画 — 逐一着色物体</td> <td>摄影 — 追踪光线</td> </tr> <tr> <td><strong>方法</strong></td> <td>经验光照模型</td> <td>物理光线交互</td> </tr> <tr> <td><strong>效率</strong></td> <td>高效</td> <td>低效</td> </tr> <tr> <td><strong>真实性</strong></td> <td>较低</td> <td>逼真</td> </tr> <tr> <td><strong>应用</strong></td> <td>实时渲染</td> <td>离线渲染</td> </tr> </tbody> </table> <hr> <h2 id="2-光源">2. 光源</h2> <h3 id="21-环境光-ambient-light">2.1 环境光 (Ambient Light)</h3> <p><strong>定义</strong>：全方向照射的光，强度相同</p> <p><strong>特点</strong>：</p> <ul> <li>是一种hack，用来模拟多次反射产生的背景光</li> <li>没有方向</li> <li>均匀照亮场景</li> </ul> <p><strong>数学表示</strong>：</p> \[I = k_a I_a\] <p>其中 $k_a$ 是环境反射率，$I_a$ 是环境光强度。</p> <h3 id="22-平行光-directional-light">2.2 平行光 (Directional Light)</h3> <p><strong>定义</strong>：光线方向相同的光源</p> <p><strong>应用场景</strong>：</p> <ul> <li>太阳光 — 距离很远，可以近似为平行光</li> <li>舞台灯光</li> </ul> <p><strong>特点</strong>：</p> <ul> <li>没有衰减</li> <li>光线方向已知且恒定</li> <li>适合远距离光源</li> </ul> <h3 id="23-点光源-point-light">2.3 点光源 (Point Light)</h3> <p><strong>定义</strong>：从单一点发出的光线向四周散发</p> <p><strong>应用场景</strong>：</p> <ul> <li>灯泡</li> <li>火焰</li> </ul> <p><strong>特点</strong>：</p> <ul> <li>有衰减（反平方律）</li> <li>光线方向随位置变化</li> </ul> <p><strong>衰减函数</strong>：</p> \[f_{att} = \frac{1}{d^2}\] <p>其中 $d$ 是光源到表面的距离。</p> <h3 id="24-聚光灯-spotlight">2.4 聚光灯 (Spotlight)</h3> <p><strong>定义</strong>：点光源加上方向性的衰减</p> <p><strong>参数</strong>：</p> <ul> <li>位置</li> <li>主方向 $\vec{D}$</li> <li>强度衰减参数</li> </ul> \[I = I_0 \cdot (\vec{l} \cdot \vec{D})^{\text{falloff}}\] <h3 id="25-面光源-area-light">2.5 面光源 (Area Light)</h3> <p><strong>定义</strong>：发光的2D表面</p> <p><strong>特点</strong>：</p> <ul> <li>产生软阴影（阴影边界模糊）</li> <li>计算复杂</li> </ul> <p><strong>实现方式</strong>：</p> <ul> <li>分解为多个点光源</li> <li>使用重要性采样</li> </ul> <hr> <h2 id="3-反射与照明模型">3. 反射与照明模型</h2> <h3 id="31-漫反射-diffuse-reflection">3.1 漫反射 (Diffuse Reflection)</h3> <h4 id="lambert定律">Lambert定律</h4> <p>漫反射材料（哑光表面）的反射强度由表面法线和光线方向决定：</p> \[I_d = k_d I_l \cos\theta = k_d I_l (\vec{n} \cdot \vec{l})\] <p><strong>参数</strong>：</p> <ul> <li>$I_d$ — 漫反射强度</li> <li>$k_d$ — 漫反射系数 ($0 \leq k_d \leq 1$)</li> <li>$I_l$ — 光源强度</li> <li>$\theta$ — 法线与光线的夹角</li> </ul> <p><strong>特点</strong>：</p> <ul> <li>从任何观察方向看亮度相同</li> <li>亮度只取决于入射光方向和表面法线</li> <li>常见于非光泽表面（纸张、布料、砖墙等）</li> </ul> <h4 id="环境光--漫反射">环境光 + 漫反射</h4> <p>结合环境光项以避免完全黑色的阴影：</p> \[I_{a+d} = k_a I_a + k_d I_l \cos\theta\] <p>这是计算机图形学早期的标准做法，虽然物理上不准确，但在实时渲染中仍然广泛使用。</p> <h3 id="32-镜面反射-specular-reflection">3.2 镜面反射 (Specular Reflection)</h3> <p><strong>定义</strong>：光线在微观光滑的表面上形成的高光</p> <p><strong>特点</strong>：</p> <ul> <li>观察角度相关 — 高光只在特定观察角度可见</li> <li>由光线和法线决定的反射方向</li> <li>常见于光泽表面（金属、抛光物体）</li> </ul> <h4 id="计算反射方向">计算反射方向</h4> <p>给定入射光方向 $\vec{l}$ 和表面法线 $\vec{n}$，反射方向 $\vec{r}$：</p> \[\vec{r} = 2(\vec{n} \cdot \vec{l})\vec{n} - \vec{l}\] <h4 id="phong照明模型">Phong照明模型</h4> <p>Phong模型用于近似镜面反射的衰减：</p> \[I_s = k_s I_l \cos^{n_s}\phi\] <p><strong>参数</strong>：</p> <ul> <li>$\phi$ — 反射光线与观察方向的夹角</li> <li>$k_s$ — 镜面反射系数</li> <li>$n_s$ — 镜面指数（控制高光锐利程度）</li> </ul> <p><strong>特点</strong>：</p> <ul> <li>$n_s$ 越大，高光越尖锐（更光滑的表面）</li> <li>$n_s$ 越小，高光越宽（更粗糙的表面）</li> <li>没有物理基础，但在图形学中广泛使用</li> <li>值通常在 100-200 之间</li> </ul> <h3 id="33-完整的phong照明方程">3.3 完整的Phong照明方程</h3> <p>结合环境光、漫反射和镜面反射：</p> \[I = k_a I_a + f_{att} I_l [k_d \max(0, \cos\theta) + k_s \cos^{n_s}\phi]\] <p><strong>对多个光源</strong>：</p> <ul> <li>对每个光源重复计算漫反射和镜面反射项</li> <li>将所有光源的贡献求和</li> <li>环境光项只计算一次</li> </ul> <p><strong>材料特性的表达</strong>：</p> <ul> <li> <strong>简单金属</strong> — $k_a$ 和 $k_d$ 有材料颜色，$k_s$ 为白色</li> <li> <strong>简单塑料</strong> — $k_s$ 也包含材料颜色</li> </ul> <hr> <h2 id="4-着色算法">4. 着色算法</h2> <p>着色的关键问题：在表面的哪些点计算照明？这直接影响渲染效果。</p> <h3 id="41-平面着色-flat-shading">4.1 平面着色 (Flat Shading)</h3> <p><strong>方法</strong>：</p> <ul> <li>计算每个基元（三角形）的一个照明值</li> <li>通常在重心处计算</li> </ul> <p><strong>优点</strong>：</p> <ul> <li>快速</li> <li>简单</li> </ul> <p><strong>缺点</strong>：</p> <ul> <li>明显的面段效应 — 多面体的面段清晰可见</li> <li>对于曲面外观不佳</li> </ul> <h3 id="42-gouraud着色">4.2 Gouraud着色</h3> <p><strong>方法</strong>：</p> <ol> <li>在每个顶点计算照明值</li> <li>在三角形内部线性插值颜色</li> </ol> <p><strong>优点</strong>：</p> <ul> <li>比平面着色更光滑</li> <li>仍然相对快速</li> </ul> <p><strong>缺点</strong>：</p> <ul> <li>屏幕空间插值错误（应该在世界空间插值）</li> <li>高光可能被”吞掉”（高光位于三角形内部时）</li> <li>在不同细节级别间切换时会产生跳跃</li> </ul> <h3 id="43-phong着色">4.3 Phong着色</h3> <p><strong>方法</strong>：</p> <ol> <li>在每个顶点存储法线</li> <li>在三角形内部插值法线（世界/模型空间）</li> <li> <strong>在每个像素点</strong>计算照明（使用插值的法线）</li> </ol> <p><strong>优点</strong>：</p> <ul> <li>非常光滑的外观</li> <li>高光更准确</li> <li>只在剪影边缘能看到多面体效应</li> </ul> <p><strong>特点</strong>：</p> <ul> <li>比Gouraud着色计算量大（需要每像素着色）</li> <li>现代GPU非常高效，通常是默认选择</li> </ul> <h3 id="44-比较">4.4 比较</h3> <table> <thead> <tr> <th>方法</th> <th>计算点数</th> <th>视觉质量</th> <th>速度</th> </tr> </thead> <tbody> <tr> <td>平面着色</td> <td>每基元1点</td> <td>差</td> <td>最快</td> </tr> <tr> <td>Gouraud着色</td> <td>每顶点1点</td> <td>中</td> <td>快</td> </tr> <tr> <td>Phong着色</td> <td>每像素1点</td> <td>好</td> <td>较慢</td> </tr> </tbody> </table> <hr> <h2 id="5-可见性问题">5. 可见性问题</h2> <h3 id="51-问题定义">5.1 问题定义</h3> <p><strong>可见性问题</strong> (Visibility Problem)：给定一个像素位置，哪个表面离观察者最近？</p> <p>这是渲染中最基本的问题之一。</p> <h3 id="52-画家算法-painters-algorithm">5.2 画家算法 (Painter’s Algorithm)</h3> <p><strong>原理</strong>：像油画一样，从后往前绘制物体</p> <p><strong>步骤</strong>：</p> <ol> <li>按深度排序对象（后到前）</li> <li>按此顺序投影和光栅化</li> <li>前面的物体会覆盖后面的</li> </ol> <p><strong>优点</strong>：</p> <ul> <li>概念简单</li> <li>处理透明度良好</li> </ul> <p><strong>缺点</strong>：</p> <ul> <li>排序可能昂贵（不是线性时间）</li> <li>遇到循环遮挡时需要分割对象</li> <li>对非多边形物体困难</li> </ul> <p><strong>问题示例</strong>：</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>两个对象A和B的深度关系可能是：
- A遮挡B (zmin(A) &lt; zmin(B))
- B遮挡A (完全相反)
- 循环遮挡 (A部分遮挡B，B部分遮挡A)
</code></pre></div></div> <h3 id="53-z-缓冲算法-z-buffer-algorithm">5.3 Z-缓冲算法 (Z-Buffer Algorithm)</h3> <p><strong>原理</strong>：维护每个像素的最小深度，只绘制更近的物体</p> <p><strong>算法</strong>：</p> <div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 初始化</span>
<span class="k">for</span> <span class="n">each</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span><span class="o">:</span>
    <span class="n">zbuf</span><span class="p">[</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="n">infinity</span>

<span class="c1">// 绘制</span>
<span class="k">for</span> <span class="n">each</span> <span class="n">object</span><span class="o">:</span>
    <span class="k">for</span> <span class="n">each</span> <span class="n">pixel</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span> <span class="n">in</span> <span class="n">object</span><span class="o">:</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">compute_depth</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">z</span> <span class="o">&lt;</span> <span class="n">zbuf</span><span class="p">[</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">]</span><span class="o">:</span>
            <span class="n">zbuf</span><span class="p">[</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="n">z</span>
            <span class="n">image</span><span class="p">[</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="n">shade</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</code></pre></div></div> <p><strong>优点</strong>：</p> <ul> <li>简单，无需排序或分割</li> <li>易于混合不同几何体类型（多边形、球体等）</li> <li>标准硬件支持</li> </ul> <p><strong>缺点</strong>：</p> <ul> <li>无法处理透明度（需要额外的技巧）</li> <li>Z-缓冲分辨率不足会产生深度排序伪影</li> <li>需要浮点精度（防止Z-fighting）</li> </ul> <h3 id="54-后向面剔除-back-face-culling">5.4 后向面剔除 (Back-Face Culling)</h3> <p><strong>原理</strong>：如果多边形法线指向远离观察者，则不渲染它</p> <p><strong>判断方法</strong>：</p> \[\vec{v} \cdot \vec{n} \geq 0 \Rightarrow \text{back-facing}\] <p>其中 $\vec{v}$ 是观察方向，$\vec{n}$ 是表面法线。</p> <p><strong>优点</strong>：</p> <ul> <li>可以消除大约一半的三角形</li> <li>对闭合物体有效</li> </ul> <p><strong>限制</strong>：</p> <ul> <li>仅对凸物体或闭合网格有效</li> <li>非闭合表面可能产生错误</li> </ul> <h3 id="55-复杂场景的优化">5.5 复杂场景的优化</h3> <p><strong>空间数据结构</strong>：</p> <ul> <li> <strong>BSP树</strong> — 二分空间划分，用于快速可见性查询</li> <li> <strong>八叉树</strong> — 层次化空间分割</li> <li> <strong>BVH</strong> — 包围体层次</li> </ul> <p><strong>几何简化</strong>：</p> <ul> <li>远处物体使用更简单的代理模型</li> <li> <strong>细节级别</strong> (LOD) — 自动选择合适的分辨率</li> </ul> <hr> <h2 id="6-阴影">6. 阴影</h2> <h3 id="61-阴影的产生">6.1 阴影的产生</h3> <p><strong>定义</strong>：阴影发生在物体被挡住时，无法接收来自光源的光。</p> <p><strong>问题</strong>：该点是否能”看到”光源？</p> <h3 id="62-阴影映射-shadow-mapping">6.2 阴影映射 (Shadow Mapping)</h3> <p><strong>基本思想</strong>：</p> <ol> <li> <strong>从光源视点渲染</strong> — 计算从光源到各表面的深度</li> <li> <strong>存储阴影贴图</strong> — 记录光源能看到的最近表面距离</li> <li> <strong>从相机着色</strong> — 检查该点是否在阴影中</li> </ol> <p><strong>算法步骤</strong>：</p> <div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 第一遍：从光源渲染</span>
<span class="k">for</span> <span class="n">each</span> <span class="n">object</span><span class="o">:</span>
    <span class="k">for</span> <span class="n">each</span> <span class="n">pixel</span> <span class="p">(</span><span class="n">xL</span><span class="p">,</span> <span class="n">yL</span><span class="p">)</span> <span class="n">in</span> <span class="n">light</span> <span class="n">view</span><span class="o">:</span>
        <span class="n">shadowZ</span><span class="p">[</span><span class="n">xL</span><span class="p">,</span> <span class="n">yL</span><span class="p">]</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span><span class="n">shadowZ</span><span class="p">[</span><span class="n">xL</span><span class="p">,</span> <span class="n">yL</span><span class="p">],</span> <span class="n">z</span><span class="p">(</span><span class="n">xL</span><span class="p">,</span> <span class="n">yL</span><span class="p">))</span>

<span class="c1">// 第二遍：从相机渲染</span>
<span class="k">for</span> <span class="n">each</span> <span class="n">object</span><span class="o">:</span>
    <span class="k">for</span> <span class="n">each</span> <span class="n">pixel</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span><span class="o">:</span>
        <span class="p">(</span><span class="n">xL</span><span class="p">,</span> <span class="n">yL</span><span class="p">,</span> <span class="n">zL</span><span class="p">)</span> <span class="o">=</span> <span class="n">TransformToLightSpace</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
        <span class="n">in_shadow</span> <span class="o">=</span> <span class="p">(</span><span class="n">zL</span> <span class="o">&gt;</span> <span class="n">shadowZ</span><span class="p">[</span><span class="n">xL</span><span class="p">,</span> <span class="n">yL</span><span class="p">]</span> <span class="o">+</span> <span class="err">ε</span><span class="p">)</span>
        <span class="n">image</span><span class="p">[</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">]</span> <span class="o">=</span> <span class="n">shade</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">in_shadow</span><span class="p">)</span>
</code></pre></div></div> <p><strong>参数</strong>：</p> <ul> <li>$\epsilon$ — 偏差（防止自阴影伪影）</li> </ul> <p><strong>优点</strong>：</p> <ul> <li>支持任意几何体</li> <li>可以预计算</li> <li>效率高</li> </ul> <p><strong>缺点</strong>：</p> <ul> <li>阴影边界会”锯齿化”（走样）</li> <li>需要额外的纹理内存</li> <li>偏差参数难以调整</li> </ul> <p><strong>改进方法</strong>：</p> <ul> <li> <strong>百分比更接近滤波</strong> (PCF) — 对阴影贴图周围进行平均</li> <li> <strong>级联阴影映射</strong> — 使用多个分辨率处理不同距离</li> <li> <strong>方差阴影映射</strong> — 使用统计方法</li> </ul> <hr> <h2 id="7-非照相写实渲染">7. 非照相写实渲染</h2> <h3 id="71-概述">7.1 概述</h3> <p><strong>非照相写实渲染</strong> (Non-Photorealistic Rendering, NPR) 致力于创建看起来像插图、素描或动画的图像，而不是照相现实。</p> <p><strong>应用</strong>：</p> <ul> <li>动画和卡通风格游戏（Genshin Impact, Arcane）</li> <li>技术插图</li> <li>医学和生物插图</li> </ul> <h3 id="72-卡通着色-toon-shading--cel-shading">7.2 卡通着色 (Toon Shading / Cel Shading)</h3> <p><strong>原理</strong>：使用<strong>离散的颜色级别</strong>而不是连续的光照变化，模拟漫画书的风格。</p> <p><strong>实现</strong>：</p> <ul> <li>使用查找表或分段函数量化照明值</li> <li>通常 2-3 个颜色级别</li> </ul> <p><strong>例子</strong>：</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>正常Phong着色: 亮度从0.0-1.0平滑变化
卡通着色:     亮度映射到 {0.2, 0.5, 1.0} 三个离散值
</code></pre></div></div> <h3 id="73-轮廓线提取">7.3 轮廓线提取</h3> <p>轮廓线是NPR中关键的视觉元素，表示物体的边界和特征。</p> <h4 id="轮廓线类型">轮廓线类型</h4> <ol> <li> <strong>不连续性</strong> — 表面褶皱、自交点</li> <li> <strong>补丁边界</strong> — 表面块之间的边界</li> <li> <strong>轮廓线和轮廓</strong> — 在视线上与法线相切的点</li> <li> <strong>抛物线</strong> — 高斯曲率为0的点</li> <li> <strong>等参线</strong> — 常数参数线</li> <li> <strong>曲率线</strong> — 主曲率方向的线</li> <li> <strong>阴影</strong> — 阴影区域和光照区域的边界</li> </ol> <h4 id="轮廓提取方法">轮廓提取方法</h4> <p><strong>方法1：法线轮廓线</strong></p> <ul> <li>使用着色法线检测视线接近与法线相切的位置</li> <li>优点：快速</li> <li>缺点：线宽难以控制</li> </ul> <p><strong>方法2：程序几何轮廓线</strong></p> <ul> <li>渲染一个略微放大的模型以获得轮廓</li> <li>结合Z-缓冲得到轮廓线</li> <li>优点：精确、线宽可控</li> <li>缺点：额外的几何处理</li> </ul> <p><strong>方法3：图像处理边缘检测</strong></p> <ul> <li>对渲染的深度/法线图进行边缘检测</li> <li>优点：后处理，不影响渲染流程</li> <li>缺点：可能检测到不期望的边缘</li> </ul> <h3 id="74-gooch着色">7.4 Gooch着色</h3> <p><strong>原理</strong>：用<strong>冷暖色转换</strong>代替深浅转换，保持可读性同时增加艺术表现力。</p> <p><strong>颜色映射</strong>：</p> \[I = \frac{1 + \vec{l} \cdot \vec{n}}{2} \cdot k_d + \left(1 - \frac{1 + \vec{l} \cdot \vec{n}}{2}\right) \cdot k_{cool}\] <p>其中：</p> <ul> <li>亮处使用温暖色调</li> <li>暗处使用冷色调</li> <li>平滑过渡</li> </ul> <p><strong>特点</strong>：</p> <ul> <li>保留照明信息</li> <li>增加艺术表现力</li> <li>更易于阅读和辨别</li> </ul> <h3 id="75-金属着色">7.5 金属着色</h3> <p><strong>观察</strong>：技术插图中金属表面通常用<strong>交替的深色和浅色条纹</strong>表示，称为<strong>各向异性反射</strong>。</p> <p><strong>实现</strong>：</p> <ul> <li>沿最大曲率的参数轴映射20条条纹</li> <li>条纹强度随机变化（0.0-0.5）</li> <li>最接近光源的条纹设为白色</li> <li>在条纹中心间进行线性插值</li> </ul> <p><strong>效果</strong>：模仿车床加工金属表面的外观。</p> <h3 id="76-从技术插图学习">7.6 从技术插图学习</h3> <p><strong>原则</strong> (Tufte的最小有效差异原则)：</p> <blockquote> <p>使所有视觉区分尽可能微妙，但仍然清晰有效。</p> </blockquote> <p><strong>NPR设计启示</strong>：</p> <ul> <li>用黑色曲线表示表面边界和轮廓</li> <li>哑光物体：用中等强度着色，根据法线显示冷暖色</li> <li>单一光源提供白色高光</li> <li>元素用简洁有效的方式表达</li> </ul> <h3 id="77-应用领域">7.7 应用领域</h3> <p><strong>医学和生物插图</strong>：</p> <ul> <li>清晰展示解剖结构</li> <li>高度样式化，易于理解</li> <li>突出重点区域</li> </ul> <p><strong>建筑可视化</strong>：</p> <ul> <li>草图风格表达设计意图</li> <li>保留必要细节，简化视觉信息</li> </ul> <hr> <h2 id="总结">总结</h2> <p>着色是从几何和材料参数到最终图像的关键步骤：</p> <ol> <li> <strong>照明模型</strong> — 从物理直觉出发的简化模型（Phong）</li> <li> <strong>着色算法</strong> — 在效率和质量间权衡（平面、Gouraud、Phong）</li> <li> <strong>可见性</strong> — Z-缓冲是现代GPU的基础</li> <li> <strong>阴影</strong> — 阴影映射是实时渲染的标准技术</li> <li> <strong>NPR</strong> — 扩展渲染范围超越照相写实</li> <li> <strong>实时性能</strong> — 现代GPU使复杂着色成为可能</li> </ol> <p>现代渲染通常采用<strong>正向</strong>和<strong>延迟</strong>着色管线的混合，以平衡灵活性和性能。</p> </div> </article> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2> <p class="mb-2">Here are some more articles you might like to read next:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2025/09/08/notesof_ML/">notes of ML</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2025/09/08/notesofvci/">notes of VCI</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2025/09/08/notesofaip/">notes of AIP</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2025/09/08/notesof_aimath/">notes of AI Math Fundamentals</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2025/09/08/notesof_ICS/">notes of ICS</a> </li> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2025 stibiums liu. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Photos from <a href="https://unsplash.com" target="_blank" rel="external nofollow noopener">Unsplash</a>. Last updated: October 30, 2025. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js?a0db7e5d5c70cc3252b3138b0c91dcaf" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?e0514a05c5c95ac1a93a8dfd5249b92e"></script> <script defer src="/assets/js/copy_code.js?c8a01c11a92744d44b093fc3bda915df" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script src="/assets/js/mathjax-setup.js?58fdb075e5aa03fbb8617845abde746c"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script defer src="/assets/js/progress-bar.js?2f30e0e6801ea8f5036fa66e1ab0a71a" type="text/javascript"></script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>
    addBackToTop();
  </script> <script type="module" src="/assets/js/search/ninja-keys.min.js?a3446f084dcaecc5f75aa1757d087dcf"></script> <ninja-keys hidebreadcrumbs noautoloadmdicons placeholder="Type to start searching"></ninja-keys> <script src="/assets/js/search-setup.js?6c304f7b1992d4b60f7a07956e52f04a"></script> <script src="/assets/js/search-data.js"></script> <script src="/assets/js/shortcut-key.js?6f508d74becd347268a7f822bca7309d"></script> </body> </html>